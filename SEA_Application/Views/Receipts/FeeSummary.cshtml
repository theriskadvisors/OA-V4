@model IEnumerable<SEA_Application.Controllers.ReceiptsController.StudentFeeSummary>

@if (User.IsInRole("Admin"))
{
    Layout = "~/Views/Shared/_AdminDashboardLayout.cshtml";
}

else if (User.IsInRole("Receptionist"))
{
    Layout = "~/Views/Shared/_ReceptionistDashboardLayout.cshtml";

}
else if (User.IsInRole("BakeryAdmin"))
{
    Layout = "~/Views/Shared/_BakeryAdminDashboardLayout.cshtml";
}
else
{
    Layout = null;
}
<style>
    .numberColumn {
        text-align: center;
    }

    #datatable_filter {
        display: block !important;
    }
</style>



<div class="tabsCon">
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" id="myTabAttr" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="Topics-tab-attr" data-toggle="tab" href="#Topics-attr" role="tab" aria-controls="Topics-attr"
               aria-selected="true">Fee Summary</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="Lessons-tab-attr" data-toggle="tab" href="#Lessons-attr" role="tab" aria-controls="Lessons-attr"
               aria-selected="false">Defaulter Students </a>
        </li>
    </ul>


    <div class="card">
        <div class="card-body p-4">

            <div class="tab-content" style="padding: 10px 0px 0px 0px;">
                <div class="tab-pane active show" id="Topics-attr" role="tabpanel" aria-labelledby="Topics-tab-attr">
                    <table class="table hover table-bordered table-striped" id="datatable">
                        <thead>
                            <tr>
                                <th>
                                    Roll No
                                </th>

                                <th>
                                    Name
                                </th>

                                <th>
                                    Session
                                </th>
                                <th>
                                    Total Fee
                                </th>
                                <th>
                                    Invoices
                                </th>
                                <th>
                                    Total Discount
                                </th>
                                <th>
                                    Fee Received
                                </th>

                                <th>
                                    Action
                                </th>


                            </tr>
                        </thead>
                        <tbody>

                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.RollNo)
                                        <input type="hidden" value="@item.Id" />
                                    </td>

                                    <td>

                                        @Html.DisplayFor(modelItem => item.Name)


                                    </td>

                                    <td style="text-align:center !important">

                                        @Html.DisplayFor(modelItem => item.Session)


                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.TotalFee)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Invoices)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.TotalDiscount)

                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.FeeReceived)

                                    </td>

                                    <td>
                                        <input onclick='printReceipt("@item.Id")' style='color:white !important' class='btn btn-sm btn-primary' type='button' value='Print' />
                                    </td>



                                </tr>
                            }
                        </tbody>

                    </table>

                </div>

                <div class="tab-pane" id="Lessons-attr" role="tabpanel" aria-labelledby="Lessons-tab-attr">



                    <table class="table hover table-bordered table-striped" width="100%" id="datatable1">
                        <thead>
                            <tr>
                                <th>
                                    Student Name
                                </th>

                                <th>
                                    Roll No
                                </th>

                                <th>
                                    Session
                                </th>
                                <th>
                                    Due Date
                                </th>
                                <th>
                                    Total Fee
                                </th>
                                <th>
                                    Fee Collected
                                </th>
                                <th>
                                    Total Discount
                                </th>
                                <th>
                                    Remaining Amount
                                </th>

                            </tr>
                        </thead>
                        <tbody id="DefaulterStudentList">

                        
                        </tbody>

                    </table>


                </div>



            </div>

         


        </div>
        </div>



    <script>
        $(document).ready(function () {

            $("#PageHeader").html("Fee Details");

            var table0 = $('#datatable').dataTable({
                buttons: [

                ],
                columnDefs: [{

                    targets: [3], className: 'numberColumn'

                },
                {

                    targets: [0], className: 'numberColumn', width: 120

                },
                {

                    targets: [2], className: 'numberColumn'

                },
                {

                    targets: [4], className: 'numberColumn'

                }

                ],

                "language": {
                    "lengthMenu": "<div class=\"d-flex showEntriesCon\">\n" +
                        "  <div class=\"p-2\">Show </div> <div class=\"showEntries\"> _MENU_\n" +
                        "  </div>\n" +
                        "  </div>",
                    "info": "<div class='showingEntriesOfTotal'>Showing <span class=\"text-info\">_START_ to _END_</span> of _TOTAL_ entries</div>",
                    "paginate": {
                        "first": "Firstt",
                        "last": "Lastt",
                        "next": ' <img src="~/Content/assets/assets/icons/Arrow2.png" alt=""> ',
                        "previous": ' <img src="~/Content/assets/assets/icons/Arrow1.png" alt=""> '
                    }
                },
                "searching": true,
                // dom: '<"class">Blfrtip',
                dom: "<'row mb-3'<'col-sm-12 col-md-2 col-lg-2'l><'col-sm-12 col-md-10 col-lg-10 datatableButtonsCon text-right'Bf>>" +
                    "<'row'<'col-sm-12 datatablesData'tr>>" +
                    "<'row mt-4'<'col-sm-12 col-md-4 col-lg-6 infoCon'i><'col-sm-12 col-md-8 col-lg-6 pagCon'p>>"

            });

            var table1 = $('#datatable1').dataTable({
                buttons: [

                ],
                columnDefs: [{

                    targets: [3], className: 'numberColumn'

                },
              
                    {

                        targets: [1], className: 'numberColumn'

                    },
                {

                    targets: [2], className: 'numberColumn'

                },
                {

                    targets: [4], className: 'numberColumn'

                    }, {

                        targets: [5], className: 'numberColumn'

                    },
                {

                        targets: [6], className: 'numberColumn'

                    }, {

                        targets: [7], className: 'numberColumn'

                    }

                ],

                "language": {
                    "lengthMenu": "<div class=\"d-flex showEntriesCon\">\n" +
                        "  <div class=\"p-2\">Show </div> <div class=\"showEntries\"> _MENU_\n" +
                        "  </div>\n" +
                        "  </div>",
                    "info": "<div class='showingEntriesOfTotal'>Showing <span class=\"text-info\">_START_ to _END_</span> of _TOTAL_ entries</div>",
                    "paginate": {
                        "first": "Firstt",
                        "last": "Lastt",
                        "next": ' <img src="~/Content/assets/assets/icons/Arrow2.png" alt=""> ',
                        "previous": ' <img src="~/Content/assets/assets/icons/Arrow1.png" alt=""> '
                    }
                },
                "searching": true,
                // dom: '<"class">Blfrtip',
                dom: "<'row mb-3'<'col-sm-12 col-md-2 col-lg-2'l><'col-sm-12 col-md-10 col-lg-10 datatableButtonsCon text-right'Bf>>" +
                    "<'row'<'col-sm-12 datatablesData'tr>>" +
                    "<'row mt-4'<'col-sm-12 col-md-4 col-lg-6 infoCon'i><'col-sm-12 col-md-8 col-lg-6 pagCon'p>>"

            });


           

            $.ajax({

                type: "POST",
                url: '/Receipts/AllDefaulterStudents',
                success: function (data) {
                    table1.fnClearTable();

                    $.each(data, function (index) {
                        debugger

                        var value = new Date(parseInt(data[index].DueDate.replace(/(^.*\()|([+-].*$)/g, '')));
                        var dat = value.getDate() +
                            "/" + (value.getMonth() +
                            1) +
                            "/" +
                          
                            value.getFullYear();

                        var RemainingAmount = parseFloat(data[index].FeeReceived) - parseFloat(data[index].TotalDiscount); 

                        table1.fnAddData([data[index].Name, data[index].RollNo, data[index].Session, dat , data[index].TotalFee, data[index].FeeReceived, data[index].TotalDiscount, RemainingAmount]);

                    })

                    table1.fnDraw();

                    var AllTds = $("#datatable1 td:nth-child(5),td:nth-child(6),td:nth-child(7),td:nth-child(8)");

                    for (var i = 0; i < AllTds.length; i++) {

                        var CommaSeparatedValue = numberWithCommas(AllTds[i].innerHTML);

                        AllTds[i].innerHTML = CommaSeparatedValue;
                    }
                }
            })


            //$('.table').on('click', 'tbody tr', function () {
            //    var td = $(this).children("td");


            //    var Id = parseInt($(td[0]).html())
            //    alert(Id)
            //    // alert(Id);
            //    //userName = userName.trim();
            //  ///  window.location.href = "/AspnetSubjectTopics/Edit?id=" + Id;
            //});

            $('#datatable').on('click', 'tbody tr td:nth-child(1),td:nth-child(2),td:nth-child(3),td:nth-child(4),td:nth-child(5),td:nth-child(6)', function () {

                var td = $(this).parent().children("td");
                var id = $(td[0]).children("input").val();

                if (id != "")
                    window.location.href = "/Receipts/FeeHistory?Id=" + id;

            });


            // var AllTds = $("td:nth-child(3)");


            //for (var i = 0; i < AllTds.length; i++) {

            //    var CommaSeparatedValue = numberWithCommas(AllTds[i].innerHTML);

            //    AllTds[i].innerHTML = CommaSeparatedValue;
            //}



        }) //end of document ready

        function printReceipt(id) {
            //  alert("id");
            window.location.href = "/Receipts/PrintFeeSummary?id=" + id;

        }
        function numberWithCommas(x) {
            debugger
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }


        //function numberWithCommas(x) {
        //    debugger
        //    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        //}

        //function printReceipt(id) {

        //    window.location.href = "/Receipts/PrintReceipt?id=" + id;

        //}
    </script>
